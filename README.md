# PROPERTY INVENTORY API

This API is in charge of processing the information of a property inventory, there are instructions such as the main technologies used, the structure of the microservice, among others.

## üõ† Used technology

- **Programming language:** Python
- **Web framework:** FastAPI
- **Database:** MySQL 
- **Testing:** The Test-Driven Development (TDD) approach is followed using unittest.
- **Web server:** Uvicorn
- **Data validation:** Pydantic

## üìö Project Organization

The development of the project follows a layer-based architecture. The code is organized as follows:

- `src/`: Where the main source code of the project is stored.
    - `controllers/`: Directory where input requests are processed.
    - `crud/`: Organize, store, and execute database operations.
    - `database/`: Directory where database connections are controlled.
    - `enums/`: Define the limited sets of options or states that can be used.
    - `schemas/`: Directory used to define the structure, validation and serialization of the data.
    - `services/`: Directory where the business logic is grouped and processed.
    - `main.py/`: Main entry point.
    - `settings.py/`: File where the microservice configurations are managed.
- `test/`:Where the project tests are executed.
- `.gitignore/`: Specify which files should be ignored by Git.
- `README.md/`: Provides information and documentation about the project.
- `requirements.txt/`: Used to specify project dependencies.

## ‚ñ∂Ô∏èConfiguration and execution

1. Clone this repository
    ```bash
    https://github.com/Walbert29/property-inventory-backend.git
    ```
2. Create and activate a virtual environment

    **Linux:**
    
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

    **Windows:**

    ```bash
    python -m venv venv
    venv\Scripts\activate
    ```

3. Install the dependencies
    ```bash
    pip install -r requirements.txt
    ```
4. Start the server
    
    **Using the main entry point:**
    ```bash
    cd src/
    python main.py
    ```
## ‚ñ∂Ô∏èRun test
    
```bash
cd test/
python -m unittest ./property_inventory.py
```

## üèÅEndpoints

### **Search properties**
This endpoint returns the properties that meet the criteria sent.

The filters are applied through query params, so there is no JSON that should be sent by Front, but there are parameters wanted in the URL, described below.

- **Path:** `/properties`
- **Method:** GET
- **Params:**
    - `status_ids` List[int]: Filter by status
    - `year_construction` (int): Filter by year of construction
    - `city` (str): Filter by city

### **React property**
This endpoint allows a user to like a property
- **Path:** `/property/{property_id}/user/{user_id}`
- **Method:** POST

## üìÉVersions

### v1.0.0

- Creation of the README with the project guidelines.

### v1.1.0

- Creation unit tests.

### v1.2.0

- The test cases have been defined.
- README update with the latest improvements and implementations.
- The properties microservice was created, with the respective validations of the models, queries to the database and transformation of the resulting data.

### v1.3.0

- Update of the README with the information of the proposed model for PropertyLiked.
- Development, implementation and testing of management challenge.

# Like Service
This microservice is intended to allow users who are registered on the platform to "Like" properties of interest to them.

## Tables construction
For the construction of the table that will store the likes generated by the users, two tables are initially required, one where the properties are stored and the other where the user information is stored.
The properties table is already created in the model, so we would proceed with the users table. For them:
- **Create User Table:**
    The construction of the user table is generated from the following script:
     ```bash
    CREATE TABLE USER (
    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,
    first_name VARCHAR(20) NOT NULL,
    last_name VARCHAR(30) NOT NULL,
    email VARCHAR(20) NOT NULL,
    created_date DATETIME
    );
    ```
    Where we generate a table with minimum required fields with important rules such as the incremental value of the ID and not accepting null values.
- **Create PropertyLikes Table:**
    This is the table where you will keep a history of the users' like reactions to the properties.
     ```bash
    CREATE TABLE PROPERTYLIKES(
    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,
    id_property INT(11) NOT NULL,
    id_user INT(11) NOT NULL,
    created_date DATETIME,
    FOREIGN KEY (id_property) REFERENCES PROPERTY(id),
    FOREIGN KEY (id_user) REFERENCES USER(id)
    );
    ```
    Important aspects of this table is its direct relationship with the user and Property tables, as well as the User table, rules were implemented for better control and data security.

An intermediate table was built to store the users' likes and dislikes, thinking mainly about flexibility, since it allows adding attributes that are considered necessary in the future without affecting the Users and Properties tables. In addition, performance was also considered, avoiding complex queries in the main tables.
![Diagrama ER PropertyLikes](https://raw.githubusercontent.com/Walbert29/property-inventory-backend/main/resources/ER-PropertyLikes.png)
    
## Infrastructure
It is necessary the creation of a microservice that is in charge of linking the Front with the information stored in the DB as well as for the processing and storage of the versions. For it a basic diagram of its operation was elaborated. Where:
1. Front sends a POST request to the Core or Midleware Backend with the information of the user that performs the action as well as of the user's own interest.
2. The Backend is in charge of consuming the user DB to verify the existence of the user in the platform. If the user is verified, the flow continues, otherwise Front is notified that the user was not found.
3. After verifying the user, it is required to verify the existence of the property in the database, for which the resource is consumed and the record is expected to be successfully saved.
![Infrastructure Like Services](https://raw.githubusercontent.com/Walbert29/property-inventory-backend/main/resources/StructureLikeService.png)

# Challenge
The challenge of rolling numbers in block, was carried out and tested with unit tests.
## Access the challenge:
1. Access the challenge folder and the test subfolder
    ```bash
    cd challenge/test
    ```
2. Run unit tests 
    ```bash
    python -m unittest ./challenge.py
    ```

# Improvement proposal
Analyzing the current structure of the database, some aspects can be improved that could generate large impacts on the performance of microservices.

## Database
Some suggested changes to the database that may impact the results and performance are:
1. Standardize the cities, with an open field, data can be lost at the moment in which users make the queries, a standardization with the minimum values ‚Äã‚Äãsuch as ID, name and description.
2. Manage the state of the properties from its main table, avoiding joining the history in the daily use of property listings. In large volumes of data, the history can be a table that fills up with information very quickly, so always using it to know the status of a property generates a high performance cost by having to consult so much data.
The proposed solution is to create a new field that is a foreign key of status_history, this being the one that would be consumed to know the current state of a property.
This diagram illustrates the points raised.
![Infrastructure Like Services](https://raw.githubusercontent.com/Walbert29/property-inventory-backend/main/resources/improve-model.png)

## Microservices
In the previously mentioned point about taking the state of the property, it can present significant changes in the microservices, this is due to the fact that the status field that will be in property is required to be always updated with the status history field.
For this, the creation of a new microservice is suggested, its main function will be to ensure the updating of both tables without any information leakage between them, controlling and standardizing the management of said fields.
![Infrastructure Like Services](https://raw.githubusercontent.com/Walbert29/property-inventory-backend/main/resources/explain-services.png)